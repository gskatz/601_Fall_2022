{
  "hash": "21bf81eb2e29c1a2aec7e4341ed0dc04",
  "result": {
    "markdown": "---\ntitle: \"Final Project: Flower Sales over the Semester\"\nauthor: \"Michaela Bowen\"\ndesription: \"Tracked Cannabis Flower Sales over Sept, Oct, Nov\"\ndate: \"12/22/2022\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - Final\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(readr)\nlibrary(readxl)\nlibrary(lubridate)\nlibrary(viridis)\n\nknitr::opts_chunk$set(echo = TRUE)\n```\n:::\n\n\n::: panel-tabset\n## Introduction\n\n### Data Summary\n\nThroughout the fall of 2022, the cannabis industry has been going through drastic market changes. With the rise of inflation, and an over saturated market, the cost of a pound of flower(bud) has decreased drastically. This data comes from a mid level adult recreational dispensary that is in a community of nearly 12 other dispensaries with similar product and clientele. There are three months worth of transaction data from the months of September, October, November and the beginning of December. Promotional items, sales, and deals have been a theme of many dispensaries in the Pioneer Valley and this dispensary has not been excluded from that.\n\nThe transaction data contains cumulatively about 36,000 transactions over the course of 3 months. Each transaction contains pertinent information for analyzing sales, and for the purposes of this document, the flower promotional sales.\n\n### Research Questions\n\n-   **Were fall flower promotions effective?:**\n\n    -   Was the most drastic promotion effective?\n\n    -   Are the strains still popular outside of the promotional window?\n\n## Read In\n\n### Data Wrangling and Manipulation of Main Data\n\nEach of the 3 months of transactions were read in similarly with unused columns deleted, and the rest renamed with more functional naming conventions. This data was of separate inventory transactions, there needed to be a full join to include all observations (transactions). There are several muated columns that were necessary in the overall analysis of the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#September transactions read in\ntransactions_sept_orig <- read_excel(\"Inventory Transactions Sept_2022.xlsx\",\n    skip = 5,\n    col_names = c(\"pos_id\",\"product\",\"delete\",\"patient_name\",\"transaction_date\",\"qty_sold\",\"daily_allottment_oz\",\"weight_grams\",\"cost\",\"price\",\"owner_name\",\"owner_location\",\"vendor\",\"sold_by\",\"receipt_no\",\"delete\",\"delete\",\"delete\",\"delete\",\"delete\"))%>%\n  filter(sold_by != \"Michaela Bowen\")%>%\n  select(!contains(\"delete\"))\n\n\n\n#October transactions read in\ntransactions_oct_orig <- read_excel(\"Inventory Transactions Oct_2022.xlsx\",\n    skip = 5,\n    col_names = c(\"pos_id\",\"product\",\"delete\",\"patient_name\",\"transaction_date\",\"qty_sold\",\"daily_allottment_oz\",\"weight_grams\",\"cost\",\"price\",\"owner_name\",\"owner_location\",\"vendor\",\"sold_by\",\"receipt_no\",\"delete\",\"delete\",\"delete\",\"delete\",\"delete\"))%>%\n  filter(sold_by != \"Michaela Bowen\")%>%\n  select(!contains(\"delete\"))\n\n\n#November transactions read in\ntransactions_nov_orig <- read_excel(\"Inventory Transactions Nov_Current_2022.xlsx\",\n    skip = 5,\n    col_names = c(\"pos_id\",\"product\",\"delete\",\"patient_name\",\"transaction_date\",\"qty_sold\",\"daily_allottment_oz\",\"weight_grams\",\"cost\",\"price\",\"owner_name\",\"owner_location\",\"vendor\",\"sold_by\",\"receipt_no\",\"delete\",\"delete\",\"delete\",\"delete\",\"delete\"))%>%\n  filter(sold_by != \"Michaela Bowen\")%>%\n  select(!contains(\"delete\"))\n\n\n\n#joint all three dataframes of transactions, also uniting common columns\ntransactions_fall <- full_join(transactions_sept_orig,transactions_oct_orig, by = 'transaction_date')%>%\n  full_join(.,transactions_nov_orig)%>%\n  unite(\"product\", c(product, product.x, product.y), na.rm = TRUE)%>%\n  unite(\"pos_id\", c(pos_id, pos_id.x, pos_id.y), na.rm = TRUE)%>%\n  unite(\"patient_name\", c(patient_name, patient_name.x, patient_name.y), na.rm = TRUE)%>%\n  unite(\"qty_sold\", c(qty_sold, qty_sold.x, qty_sold.y), na.rm = TRUE)%>%\n  unite(\"daily_allottment_oz\", c(daily_allottment_oz, daily_allottment_oz.x, daily_allottment_oz.y), na.rm = TRUE)%>%\n  unite(\"weight_grams\", c(weight_grams, weight_grams.x, weight_grams.y), na.rm = TRUE)%>%\n  unite(\"cost\", c(cost, cost.x, cost.y), na.rm = TRUE)%>%\n  unite(\"price\", c(price, price.x, price.y), na.rm = TRUE)%>%\n  unite(\"owner_name\", c(owner_name, owner_name.x, owner_name.y), na.rm = TRUE)%>%\n  unite(\"owner_location\", c(owner_location, owner_location.x, owner_location.y), na.rm = TRUE)%>%\n  unite(\"vendor\", c(vendor, vendor.x, vendor.y), na.rm = TRUE)%>%\n  unite(\"sold_by\", c(sold_by, sold_by.x, sold_by.y), na.rm = TRUE)%>%\n  unite(\"receipt_no\", c(receipt_no, receipt_no.x, receipt_no.y), na.rm = TRUE)\n  \n\n  \n#mutating necessary columns\ntransactions_fall <- transactions_fall%>%\n#creating date, day, hour, minute, second, columns \n  mutate(\n    date = as.Date(transaction_date),\n    day = day(transaction_date),\n    hour = hour(transaction_date),\n    minute = minute(transaction_date),\n    second = second(transaction_date))%>%\n  mutate(\n    format_date = format(date, \"%m/%d/%Y\"),\n    format_hour = paste(hour, minute, second, sep = \":\")\n  )%>%\n#pulling the category abbreviation to determine category and create a category column \n  mutate(\n    category = substr(product,1,3),\n  )%>%\n#changing the abbreviations into full category names\n  mutate(\n    category_names = case_when(\n      category == \"FLO\" | category == \"Flo\" ~ \"Flower\",\n      category == \"PRJ\" & weight_grams == 0.5 ~ \"Joint 0.5g\",\n      category == \"PRJ\" & weight_grams == 1 ~ \"Joint 1g\",\n      category == \"PRJ\" & weight_grams == 2.5 ~ \"Joint 0.5g 5pk\",\n      category == \"PRJ\" ~ \"Other Joint\",\n      category == \"EDI\" ~ \"Edible\",\n      category == \"CON\" | category == \"Con\" | category == \"MIP\" ~ \"Concentrate\",\n      category == \"VAP\" | category == \"Vap\" ~ \"Vaporizer\",\n      category == \"ACC\" | category == \"Pax\" | category == \"PAX\" | category == \"Hig\" | category == \"Bov\" ~ \"Accessories\",\n      category == \"CLO\" | category == \"Res\" ~ \"Clothing\",\n      category == \"HTC\" ~ \"ignore\",\n      category == \"SAM\" ~ \"ignore\",\n      category == \"TOP\" ~ \"Topical\",\n      category == \"REW\" ~ \"ignore\")\n  )%>%\n#created a logical variable to determine if flower was in house, or 3rd party\n  mutate(\n    house_product = case_when(\n      vendor == \"Resinate, Inc.\" ~ TRUE,\n      vendor != \"Resinate, Inc.\" ~ FALSE\n    )\n)\n```\n:::\n\n\n### Data Wrangling and Manipulation of Flower Data\n\nGiven that the price of the pound of flower is down, lowering the price of the 8th, as well as promoting different strains is necessary to compete within the market. In order to do that, Flower transactions need to be isolated. There are several mutated variables that are necessary in the flower analysis included, total product sold by date, products sold by date and strain, and percent of products sold by date and strain.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create flower transactions only dataframe \n\ntransactions_flower <- transactions_fall%>%\n  filter(category == \"FLO\")%>%\n\n  #create strain variable  \n  \n  mutate(\n    weight_grams = as.double(weight_grams),\n    strain = case_when(\n      grepl(\"Flower\", product) & (weight_grams == 1 | weight_grams == 14) ~ (str_extract(product,\"(?<=Flower ).+(?= 1)\" )),\n      grepl(\"Flower\", product) & (weight_grams == 3.5)~ (str_extract(product,\"(?<=Flower ).+(?= 3.)\" )),\n      grepl(\"Material\", product) & (weight_grams == 7)~ (str_extract(product,\"(?<=Material ).+(?= 7)\" )),\n      grepl(\"Shake\", product) & (weight_grams == 7) ~ (str_extract(product,\"(?<=Shake ).+(?= 7)\" )),\n      grepl(\"Shake\", product) & (weight_grams == 1 | weight_grams == 14) ~ (str_extract(product,\"(?<=Shake ).+(?= 1)\" )),\n      grepl(\"Popcorn\", product) ~ (str_extract(product,\"(?<=Popcorn ).+(?= 3.)\" )),\n      grepl(\"Collective\", product) ~ (str_extract(product,\"(?<=Collective ).+(?= 3.)\" ))\n      )\n    )%>%\n  \n  #create total  product sold by strain and date\n  \n    group_by(strain,date)%>%\n    mutate(sold_by_strain = sum(as.double(qty_sold)),\n  )%>%\n  \n  #create total product sold by date\n\n  group_by(date)%>%\n    mutate(sold_by_date = sum(as.double(qty_sold)),\n  )%>%\n  \n  mutate(percent_sold = 100*(sold_by_strain/sold_by_date),\n        )\n```\n:::\n\n\n## Flower Transactions over Time by Strain\n\n### All Resinate Strains\n\n\n::: {.cell}\n\n```{.r .cell-code}\npercent_strain_day <- transactions_flower%>%\n  filter(house_product == TRUE)%>%\n  arrange(date, -percent_sold)%>%\n  distinct(strain, .keep_all = TRUE)%>%\n  ggplot(aes(x = date, y = percent_sold, group = strain, fill = strain)) +\n  geom_area() +\n  scale_fill_viridis(discrete = TRUE) +\n  labs(\n    title =  \"% Sold by Strain\",\n    caption = \"Data provided by Resinate, Inc.\"\n    )+\n  xlab(\" \") +\n  ylab(\"% of flower sales\") +\n  theme_bw() +\n  theme(\n      legend.position=\"none\",\n      panel.spacing = unit(0.2, \"lines\"),\n      panel.spacing.x = unit(.5, \"lines\"),\n      strip.text.x = element_text(size = 8),\n      plot.title = element_text(size=14)\n    ) +\n  scale_x_date(\n    date_breaks = \"1 month\",\n    date_labels = \"%b\"\n  ) +\n  facet_wrap(~strain)\n\npercent_strain_day\n```\n\n::: {.cell-output-display}\n![](MichaelaBowen_Final_files/figure-html/main visualization-1.png){width=672}\n:::\n:::\n\n\n### Best Promoted Strains\n\nWhen referring to the Biweekly promotions it is clear that the promotions were effective as each strain has peaks related to the weeks of their promotions. The steepest promotions of the fall were for the month of November from 11/2 - 11/17, where four strains (Truthband, Lemon 18, Cappachino and Jigglers), were promoted for the price of \\$18.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_promo <- transactions_flower%>%\n  filter(strain == c(\"Lemon 18\", \"Truthband\", \"Cappachino\", \"Jigglers\"))%>%\n  ggplot(aes(x = date, y = percent_sold, group = strain, color = strain)) +\n  geom_point(size = 1.5) +\n  geom_line() +\n  scale_x_date(\n    date_labels  = \"%d-%b\",\n    date_breaks = \"2 weeks\",\n    date_minor_breaks = \"days\"\n  ) +\n  scale_color_manual(values = c(\"#440154FF\", \"#31688EFF\", \"#35B779FF\", \"#FDE725FF\")) +\n  labs(\n        title =  \"Percentage of Strain Sales by Date\",\n        subtitle = \"$18 Eighths\",\n       caption = \"Data provided by Resinate, Inc.\")+\n  xlab(\" \") +\n  ylab(\"% of flower sales\") +\n  ylim(0,100) +\n  theme_bw() +\n  theme(\n    legend.position = \"none\",\n    axis.text.x = element_text(angle = 60, hjust = 1)\n    ) +\n  facet_wrap(~strain)\n\nbest_promo\n```\n\n::: {.cell-output-display}\n![](MichaelaBowen_Final_files/figure-html/individual strain graphs-1.png){width=672}\n:::\n:::\n\n\n-   We can see that on 11/3 there is a sharp increase in Truthband sales, when the weeks before sales had been relatively low. We can see for the two week period in which Truthband was \\$18, that strain accounted for 40%+ of total flower sales for that day, and when the price increased to \\$25, sales dropped off.\n    -   Lemon 18 was also price dropped to \\$18 on the same date as the Truthband, it is interesting to note that there was not a drastic increase in sales for this strain\n-   During the second wave of \\$18 eighths, Cappachino and Jigglers were featured, and it is clear that each of those strains accounted for a larger percentage of the total flower sales for the day.\n\n### Common Strain\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsundae_sunset_transactions <- transactions_flower%>%\n  filter(strain == \"Sundae Sunset\")%>%\n  ggplot(aes(x = date, y = percent_sold, group = strain, color = strain)) +\n  geom_point(size = 1.5) +\n  geom_line() +\n  scale_x_date(\n    date_labels  = \"%d-%b\",\n    date_breaks = \"2 weeks\",\n    date_minor_breaks = \"days\"\n  ) +\n  scale_color_manual(values = \"#440154FF\") +\n  labs(\n        title =  \"Percentage of Sundae Sunset Sales by Date\",\n       caption = \"Data provided by Resinate, Inc.\")+\n  xlab(\" \") +\n  ylab(\"% of flower sales\") +\n  ylim(0,100) +\n  theme_bw() +\n  theme(\n    legend.position = \"none\",\n    axis.text.x = element_text(angle = 60, hjust = 1)\n    ) +\n  facet_wrap(~strain)\n\nsundae_sunset_transactions\n```\n\n::: {.cell-output-display}\n![](MichaelaBowen_Final_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n-   Sundae Sunset is a strain that is almost always in stock, it is a staple well liked strain. During the first month of fall from 9/8 - 10/5, it was on sale for \\$25 and then \\$20. During that timeframe the overall percentage of Sundae Sunset sales was significantly higher, and drops off drastically on 10/5, when the item fell off promotion for the rest of the season.\n\n### Promotions\n\nWithin a two week promotional period, each category has one or two deals or promotional items. Typically, the flower category will always contain one strain priced between \\$18-\\$35, which tend to be the most popular for the time they are on sale.\n\n-   9/8 - 9/21\n\n    -   Lemon 18 & Sundae Sunset \\$25\n\n-   9/22 - 10/5\n\n    -   Phone Home, Jigglers & Sundae Sunset \\$20\n\n    -   Cappachino \\$35\n\n-   10/6 - 10/19\n\n    -   Phone Home, Lava Cake \\$20\n\n    -   Cappachino \\$35\n\n-   10/20 - 11/02\n\n    -   Phone Home, Lava Cake \\$20\n\n    -   Cappachino \\$30\n\n-   11/03 - 11/17\n\n    -   Lemon 18, Truthband \\$18\n\n    -   Cappachino \\$25\n\n-   11/18 - 11/30\n\n    -   Jigglers, Cappachino \\$18\n\n    -   Truthband \\$25\n\n-   12/1 - 12/14\n\n    -   El Chapo \\$20\n\n    -   Cappachino \\$25\n:::\n",
    "supporting": [
      "MichaelaBowen_Final_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}