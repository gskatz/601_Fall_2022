{
  "hash": "c51eaf1b68bd3d7d4f891f30eb67b193",
  "result": {
    "markdown": "---\ntitle: \"Olympic Analysis\"\nauthor: \"Matthew Norberg\"\ndate: \"10/11/2022\"\nformat: \n  html: \n    toc: true\n    code-copy: true\n    code-tools: true\n    smooth-scroll: true\n    code-line-numbers: true\n    highlight-style: github\n    theme: zephyr\n    df-print: default\ncategories:\n  - hw2\n  - Olympic_Data\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Data Description\n\nI choose to investigate a dataset containing information about the [Olympic Games](https://www.kaggle.com/datasets/heesoo37/120-years-of-olympic-history-athletes-and-results?select=athlete_events.csv) between 1896 and 2016.  The data set is read in and displayed using the code below. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in the data set\nathletes <- read_csv('./Data/athlete_events.csv')\nnoc <- read_csv('./Data/noc_regions.csv')\n\n# Display the athlete data set\nathletes\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 271,116 × 15\n      ID Name     Sex     Age Height Weight Team  NOC   Games  Year Season City \n   <dbl> <chr>    <chr> <dbl>  <dbl>  <dbl> <chr> <chr> <chr> <dbl> <chr>  <chr>\n 1     1 A Dijia… M        24    180     80 China CHN   1992…  1992 Summer Barc…\n 2     2 A Lamusi M        23    170     60 China CHN   2012…  2012 Summer Lond…\n 3     3 Gunnar … M        24     NA     NA Denm… DEN   1920…  1920 Summer Antw…\n 4     4 Edgar L… M        34     NA     NA Denm… DEN   1900…  1900 Summer Paris\n 5     5 Christi… F        21    185     82 Neth… NED   1988…  1988 Winter Calg…\n 6     5 Christi… F        21    185     82 Neth… NED   1988…  1988 Winter Calg…\n 7     5 Christi… F        25    185     82 Neth… NED   1992…  1992 Winter Albe…\n 8     5 Christi… F        25    185     82 Neth… NED   1992…  1992 Winter Albe…\n 9     5 Christi… F        27    185     82 Neth… NED   1994…  1994 Winter Lill…\n10     5 Christi… F        27    185     82 Neth… NED   1994…  1994 Winter Lill…\n# … with 271,106 more rows, and 3 more variables: Sport <chr>, Event <chr>,\n#   Medal <chr>\n```\n:::\n\n```{.r .cell-code}\n# Display the noc data set\nnoc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 230 × 3\n   NOC   region      notes               \n   <chr> <chr>       <chr>               \n 1 AFG   Afghanistan <NA>                \n 2 AHO   Curacao     Netherlands Antilles\n 3 ALB   Albania     <NA>                \n 4 ALG   Algeria     <NA>                \n 5 AND   Andorra     <NA>                \n 6 ANG   Angola      <NA>                \n 7 ANT   Antigua     Antigua and Barbuda \n 8 ANZ   Australia   Australasia         \n 9 ARG   Argentina   <NA>                \n10 ARM   Armenia     <NA>                \n# … with 220 more rows\n```\n:::\n:::\n\n\nThe dataset comes as a set of two csv files: 'athlete_events' and 'noc_regions' where each file represents a table in a relational database.  The 'athlete_events' table contains most of the information that I am interested in.  Each row in this table contains information about an athlete who competed in an Olympic event.  Note that athletes can occur in the table more than once if they competed in multiple events or games.  A good example of this is Michael Phelps who appears in the athletes table many times.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find all the rows containing information about Michael Phelps\nfilter(athletes, str_detect(Name, \"Michael\") & str_detect(Name, \"Phelps\")) %>%\n  select(-c(ID, NOC, Sex, Height, Weight, Season))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 30 × 9\n   Name                      Age Team        Games  Year City  Sport Event Medal\n   <chr>                   <dbl> <chr>       <chr> <dbl> <chr> <chr> <chr> <chr>\n 1 Michael Fred Phelps, II    15 United Sta… 2000…  2000 Sydn… Swim… Swim… <NA> \n 2 Michael Fred Phelps, II    19 United Sta… 2004…  2004 Athi… Swim… Swim… Bron…\n 3 Michael Fred Phelps, II    19 United Sta… 2004…  2004 Athi… Swim… Swim… Bron…\n 4 Michael Fred Phelps, II    19 United Sta… 2004…  2004 Athi… Swim… Swim… Gold \n 5 Michael Fred Phelps, II    19 United Sta… 2004…  2004 Athi… Swim… Swim… Gold \n 6 Michael Fred Phelps, II    19 United Sta… 2004…  2004 Athi… Swim… Swim… Gold \n 7 Michael Fred Phelps, II    19 United Sta… 2004…  2004 Athi… Swim… Swim… Gold \n 8 Michael Fred Phelps, II    19 United Sta… 2004…  2004 Athi… Swim… Swim… Gold \n 9 Michael Fred Phelps, II    19 United Sta… 2004…  2004 Athi… Swim… Swim… Gold \n10 Michael Fred Phelps, II    23 United Sta… 2008…  2008 Beij… Swim… Swim… Gold \n# … with 20 more rows\n```\n:::\n:::\n\n\nEach row in the athletes table contains the National Olympic Committee that they are competing for which is stored as a three letter code in the 'NOC' column. The 'NOC' column serves as a foreign key to the 'noc_regions' table.  The 'noc_regions' table maps the National Olympic Committee code to its corresponding country and provides additional notes about the committee.  For example, consider this row in 'noc_regions': (HKG, China, Hong Kong).  This tells us that the code HKG corresponds Hong Kong Olympic Committee in China.  \n\nIn the majority of the cases, the 'notes' column of the 'noc_regions' table is empty.  The case I gave in the previous example is an outlier case in which it is present.  In cases where it is present, it often provides another way besides the NOC code to distinguish between two committees from the same region.  The code chunk below display all the entries in the 'noc_regions' table that have notes associated with it.  Notice that many of the rows in the table have the same region.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# List the countries have non-null values in 'notes' column\nnoc %>%\n  filter(!is.na(notes)) %>%\n  arrange(region)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 21 × 3\n   NOC   region                      notes                      \n   <chr> <chr>                       <chr>                      \n 1 ANT   Antigua                     Antigua and Barbuda        \n 2 ANZ   Australia                   Australasia                \n 3 NFL   Canada                      Newfoundland               \n 4 HKG   China                       Hong Kong                  \n 5 AHO   Curacao                     Netherlands Antilles       \n 6 BOH   Czech Republic              Bohemia                    \n 7 CRT   Greece                      Crete                      \n 8 IOA   Individual Olympic Athletes Individual Olympic Athletes\n 9 NBO   Malaysia                    North Borneo               \n10 SKN   Saint Kitts                 Turks and Caicos Islands   \n# … with 11 more rows\n```\n:::\n:::\n\n\n## Cleaning The Data\n\n### Initial Transformations\n\nThe data was collected in csv format, which made it easy to read into a tibble.  However, the data is not yet tidy.  We will need to perform cleaning operations to make the data neater for analysis. \n\nWe can start by dropping the 'Games' column.  We don't need the 'Games' column because each entry in the column is a combination of the 'Year' and 'Season' columns which are already present in the data set. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get rid of id & games column\nathletes <- select(athletes, -c(Games))\n```\n:::\n\n\nNext, we can add the region from the 'noc_region' file to the athletes tibble so that we only have one tibble to work with.  I choose to drop the 'notes' column in the noc file because most of the values are not available and the values which are available don't provide much useful information. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Combine information from noc table\nathletes <- inner_join(athletes, noc) %>% select(-(notes))\n```\n:::\n\n\nWe can clean up the 'Medal' column by replacing the values that are not available with the string \"None\".  Based on the context of the data set, we can assume that a NA in this column means that the athlete did not win a Medal in that event.  Therefore, replacing these values with \"None\" seems logical.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Switch NA in Medal to None\nathletes <- athletes %>% replace_na(list(Medal = \"None\"))\n```\n:::\n\n\n### Handling Missing Values\n\nThere are four columns in the data set which contain missing values: 'Region', 'Age', 'Height', and 'Weight'.  I started by handling the missing values in the 'region' column first because it is the simplist.  We can find the 'NOC' associated with unknown regions by querying the 'noc_regions' data set. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Display NA in region\nfilter(noc, is.na(region))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 3\n  NOC   region notes               \n  <chr> <chr>  <chr>               \n1 ROT   <NA>   Refugee Olympic Team\n2 TUV   <NA>   Tuvalu              \n3 UNK   <NA>   Unknown             \n```\n:::\n:::\n\n\nWe know that any row in athletes that has an 'NOC' value of 'ROT', 'TUV', or 'UNK' will have a value in the 'Region' column that is NA.   I think it would be sensible to replace the NA values according to the table below. \n\n| NOC | Region | Notes                |\n| --- | ------ | -------------------- |\n| ROT | None   | Regugee Olympic Team |\n| TUV | Tuvala | Tuvala               |\n| UNK | Unkown | Unknown              |\n\nThe Refugee Olympic Team does not have a region, so I think it is sensible to replace those missing values with \"None\".  I did a google search and learned that [Tuvala](https://en.wikipedia.org/wiki/Tuvalu) is a small indpenent island nation so it makes sense to replace those missing values with \"Tuvala\".  Lastly, I think it is fair to replace the missing values associated with the UNK NOC as \"Unknown\".  The code below changes the missing values according to the table above. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fill in missing values in Region column\nathletes <- athletes %>%\n            mutate(Temp = case_when(NOC == \"ROT\" ~ \"None\",\n                                      NOC == \"TUV\" ~ \"Tuvala\",\n                                      NOC == \"UNK\" ~ \"Unknown\")) %>%\n            mutate(Region = case_when(is.na(region) ~ Temp,\n                                      !is.na(region) ~ region)) %>%\n            select(-c(region, Temp))\n```\n:::\n\n\nLet's handle the missing values in the 'Age', 'Height', and 'Weight' columns next.  Suppose we find a missing value in the 'Age' column.  I think a reasonable idea would be to replace the missing value with the average age during the Olympic games that occurred in that year.  We know that 'Year' column of the data set does not contain any missing values.  Therefore, if we find a missing value in the 'Age' column, we can extract the value of the 'Year' column in that row and we know it will not be missing.  Then we can calculate the average age during that year and replace the missing value with the average value.  Using this approach, we can replace all the missing values in these columns.\n\nFirst, let's calculate the average age, height, and weight for each year in the data set.  This is calculated and stored in the tibble using the code chunk below. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute average age, height, and weight by years\nAverageValues <- athletes %>%\n                 group_by(Year) %>%\n                 summarise(AverageAge = round(mean(Age, na.rm = TRUE), digits = 0),\n                           AverageHeight = round(mean(Height, na.rm = TRUE), digits = 0),\n                           AverageWeight = round(mean(Weight, na.rm = TRUE), digits = 1))\n# Display the results\nAverageValues\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 35 × 4\n    Year AverageAge AverageHeight AverageWeight\n   <dbl>      <dbl>         <dbl>         <dbl>\n 1  1896         24           173          71.4\n 2  1900         29           177          74.6\n 3  1904         27           176          72.2\n 4  1906         27           178          75.9\n 5  1908         27           178          75.4\n 6  1912         28           177          73.1\n 7  1920         29           176          73.1\n 8  1924         28           175          71.7\n 9  1928         29           175          71  \n10  1932         33           174          70.5\n# … with 25 more rows\n```\n:::\n:::\n\n\nNow that we have computed the averages, it is time to replace the missing values.  The 'cleanColumn' function cleans all of the columns mentioned above.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to clean age, height, and weight\ncleanColumn <- function(column, indx) {\n  # Iterate along the age column\n  for (i in seq_along(column)) {\n    # Extract the current age\n    cVal <- column[[i]]\n    # Check for NA value\n    if (is.na(cVal)) {\n      # Extract year from the row\n      cYear <- slice(athletes, i)$Year[[1]]\n      # Replace the NA value with the average age from year\n      column[[i]] <- filter(AverageValues, Year == cYear)[[indx]][[1]]\n    }\n  }\n  # Return cleaned column\n  return(column)\n}\n# Set age, height, and weight to cleaned version\nathletes$Age <- cleanColumn(athletes$Age, 2)\nathletes$Height <- cleanColumn(athletes$Height, 3)\nathletes$Weight <- cleanColumn(athletes$Weight, 4)\n```\n:::\n\n\n### Cleaning Sport & Event\n\nThere is another transformation I would like to perform to make the data set a bit cleaner.  Take a look at the first few values in the 'Sport' and 'Event' column.  They are presented below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Display first few rows of Sport and Event columns\nathletes %>% \n  select(Sport, Event) %>%\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n  Sport         Event                             \n  <chr>         <chr>                             \n1 Basketball    Basketball Men's Basketball       \n2 Judo          Judo Men's Extra-Lightweight      \n3 Football      Football Men's Football           \n4 Tug-Of-War    Tug-Of-War Men's Tug-Of-War       \n5 Speed Skating Speed Skating Women's 500 metres  \n6 Speed Skating Speed Skating Women's 1,000 metres\n```\n:::\n:::\n\n\nNotice how the first word or set of words in the 'Event' column is the same exact string in the 'Sport' column.  The code chunk below confirms that this pattern is true throughout the entire data set.  Note, I did not evaluate this code to speed up the rendering process.  However, the output can be verified by running this qmd file. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntestCols <- function() {\n  # Iterate along sport column\n  for (i in seq_along(athletes$Sport)) {\n    # Get the sport and event string at row i\n    # Split each string on space character\n    sport <- str_split(athletes$Sport[[i]], \" \")[[1]]\n    event <- str_split(athletes$Event[[i]], \" \")[[1]]\n    # Iterate over items in sport list\n    for (j in seq_along(sport)) {\n      # Check to see if each item in sport is equivalent to corresponding item in event\n      if (sport[[j]] != event[[j]]) {\n        # If it is not equivalent -> stop and display sport and event which breaks pattern\n        cat(\"BREAK\\n\", sport, \" \", event, \"\\nPattern does not hold\")\n        return(FALSE)\n      }\n    }\n  }\n  # If we get here, then the property holds for the entire data set\n  cat(\"Pattern holds for entire data set\\n\")\n  return(TRUE)\n}\ntestCols()\n```\n:::\n\n\nI would like to remove the first few words that in the 'Event' column that are also present in the 'Sport' column.  This will clean up the data set even more.  Furthermore, we are not losing any information because we have confirmed that everything we are throwing away appears in the 'Sport' column.  The following chunk of code cleans the 'Event' column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to clean event column\ncleanEvent <- function() {\n  # Iterate along and event columns\n  for (i in seq_along(athletes$Sport)) {\n    # Split sport and event string at row i on space character\n    sport <- str_split(athletes$Sport[[i]], \" \")[[1]]\n    event <- str_split(athletes$Event[[i]], \" \")[[1]]\n    # Empty string to store new event\n    newEvent <- \"\"\n\n    # Iterate along event list\n    for (j in seq_along(event)) {\n      # Once we get past the length of sport, start piecing together newEvent\n      if (j > length(sport)) {\n        newEvent = str_c(newEvent, event[[j]], \" \")\n      }\n    }\n    \n    # Reset newEvent string at position i\n    athletes$Event[[i]] <- newEvent\n  }\n  \n  # Return cleaned column to save changes\n  return(athletes$Event)\n}\nathletes$Event <- cleanEvent()\n```\n:::\n\n\n### Reordering & Arranging\n\nLastly, let's finish the cleaning process by reordering the columns and sorting them to make the data set easier to look at. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Change column order and sort by year\nathletes <- athletes %>% \n  relocate(Team, .after = Name) %>%\n  relocate(NOC, .after = Team) %>%\n  relocate(Region, .after = NOC) %>%\n  arrange(Year)\n```\n:::\n\n\n## Saving Cleaned Data\n\nSome of the operations that were required to clean the data set took some time to complete.  To save time later, let's save the clean data set in a new csv file so we don't have to repeat all of the cleaning operations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save cleaned data set\nwrite_csv(athletes, './Data/athletes_clean.csv')\n```\n:::\n\n\nFinally, let's read in the new csv file and present the cleaned data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in saved data set and display\nathletes <- read_csv('./Data/athletes_clean.csv')\nathletes\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 270,767 × 15\n      ID Name    Team  NOC   Region Sex     Age Height Weight  Year Season City \n   <dbl> <chr>   <chr> <chr> <chr>  <chr> <dbl>  <dbl>  <dbl> <dbl> <chr>  <chr>\n 1  1724 \"Arist… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n 2  1724 \"Arist… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n 3  1725 \"Konst… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n 4  1725 \"Konst… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n 5  4113 \"Anast… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n 6  4116 \"Ioann… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n 7  4189 \"Nikol… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n 8  4431 \"Georg… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n 9  4493 \"Antel… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n10  5660 \"Georg… Gree… GRE   Greece M        24    173   71.4  1896 Summer Athi…\n# … with 270,757 more rows, and 3 more variables: Sport <chr>, Event <chr>,\n#   Medal <chr>\n```\n:::\n:::\n\n\n## Potential Research Questions\n\nI am interested if there are relationships between success in the Olympics (whether you got a medal or not) and variables such as height, weight, age, and country.  I believe we can use this data set to see what correlates with winning medals. \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}