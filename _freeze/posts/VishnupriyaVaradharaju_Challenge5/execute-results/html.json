{
  "hash": "9e1fd656a048b6975738e48dffcc9d31",
  "result": {
    "markdown": "---\ntitle: \"Challenge 5 Solutions\"\nauthor: \"Vishnupriya Varadharaju\"\ndescription: \"Introduction to Visualization\"\ndate: \"11/24/2022\"\nformat:\n  html:\n    toc: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - challenge_5\n  - railroads\n  - cereal\n  - air_bnb\n  - pathogen_cost\n  - australian_marriage\n  - public_schools\n  - usa_households\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(\"readxl\")\nlibrary(stringr)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Challenge Overview\n\n\n## Read in data\n\nWorking with the USA Households data set. Had previously read, cleaned and pivoted this dataset from challenge 3. Re-using the same cleaned data here. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Reading in the USA Households dataset\n# Removing the total column as information is redundant\nh_income <- read_excel(\"_data/USA Households by Total Money Income, Race, and Hispanic Origin of Householder 1967 to 2019.xlsx\",\n         skip=5, n_max = 351, col_names=c(\"year\", \"hnumber\", \"total\",\"level1\", \"level2\",\n                                          \"level3\",\"level4\",\"level5\",\"level6\",\"level7\",\"level8\",\n                                          \"level9\",\"median_income\",\"median_error\",\n                                    \"mean_income\",\"mean_error\") ) %>% select(-total)\n\nincome_vals <- c(\"level1\",\"level2\",\"level3\",\"level4\",\"level5\",\"level6\",\"level7\",\"level8\",\"level9\")\nincome_levels <- c(\"Under $15000\",\"$15000 to $29000\",\"$25000 to $34999\",\"$35000 to $49999\",\"$50000 to $74999\",\"$75000 to $99999\",\"$100000 to $149999\",\"1500000 to $199999\",\"$200000 and over\")\nh_income\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 351 × 15\n   year   hnumber level1 level2 level3 level4 level5 level6 level7 level8 level9\n   <chr>  <chr>    <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n 1 ALL R… <NA>      NA     NA     NA     NA     NA     NA     NA     NA     NA  \n 2 2019   128451     9.1    8      8.3   11.7   16.5   12.3   15.5    8.3   10.3\n 3 2018   128579    10.1    8.8    8.7   12     17     12.5   15      7.2    8.8\n 4 2017 2 127669    10      9.1    9.2   12     16.4   12.4   14.7    7.3    8.9\n 5 2017   127586    10.1    9.1    9.2   11.9   16.3   12.6   14.8    7.5    8.5\n 6 2016   126224    10.4    9      9.2   12.3   16.7   12.2   15      7.2    8  \n 7 2015   125819    10.6   10      9.6   12.1   16.1   12.4   14.9    7.1    7.2\n 8 2014   124587    11.4   10.5    9.6   12.6   16.4   12.1   14      6.6    6.8\n 9 2013 3 123931    11.4   10.3    9.5   12.5   16.8   12     13.9    6.7    6.9\n10 2013 4 122952    11.3   10.4    9.7   13.1   17     12.5   13.6    6.3    6  \n# … with 341 more rows, and 4 more variables: median_income <dbl>,\n#   median_error <dbl>, mean_income <chr>, mean_error <chr>\n```\n:::\n:::\n\n\n### Briefly describe the data\n\nIn the above data, we have the necessary household income values for various throughout different years.\nThe levels of the income range have also been named accordingly and the mapping is found in the vector 'income_levels'. There is a need to pivot this data in order to get the the races corresponding to each year. Currently, the races are only present atop each section of data. Pivoting will help in grouping the data and making calculations easier against different categories of race.\n\n## Tidy Data (as needed)\n\nThere is a lot of work that needs to be done to this dataset. Firstly, the data needs to be pivoted such that for each entry we know the corresponding race. Currently, the race category is not directly present. Next, the null values in the dataset have to be looked and replaces as NA. Furthermore, the datatypes of each field have to be checked.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating a new column named race_cat + removing the rows with string only \n# race category\nh_income_race <- h_income %>% mutate(race_cat = case_when(\n  str_detect(year, \"[A-Za-z]\") ~ year,\n  TRUE ~ NA_character_\n)) %>% fill(race_cat) %>% filter(!str_detect(year, \"[A-Za-z]\"))\n\n# Removing the notes number from the year and race_cat columns\nh_income_race <- h_income_race %>% separate(year, c(\"year\",\"notes\"), sep = \" \") %>% select(-notes)\nh_income_race$race_cat <- gsub('[0-9]+', '', h_income_race$race_cat)\n\n# Detected some non numeric characters in the numeric fields. So need to remove them\nh_income_race <- h_income_race %>%\n    mutate(across(c(hnumber, starts_with(\"level\"), starts_with(\"me\")),~ replace(.,str_detect(., \"[A-Za-z]\"), NA))) %>% mutate_at(vars(hnumber, starts_with(\"me\"), starts_with(\"level\")), as.numeric)\n\nclass(h_income_race$hnumber)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"numeric\"\n```\n:::\n:::\n\n\n\nThere are 12 different categories of races. For easier visualization, categories with overlap can be grouped into a common groups.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_h_income <- h_income_race %>% mutate(\n  gp_race_cat = case_when(\n    grepl(\"BLACK\", race_cat, fixed=TRUE) ~ \"grp_black\",\n    grepl(\"ASIAN\", race_cat, fixed=TRUE) ~ \"grp_asian\",\n    grepl(\"WHITE\", race_cat, fixed=TRUE) ~ \"grp_white\",\n    grepl(\"HISPANIC\", race_cat, fixed=TRUE) & !grepl(\"NOT\", race_cat, fixed=TRUE) ~ \"grp_hisp\",\n    grepl(\"ALL\", race_cat, fixed=TRUE) ~ \"grp_all\",\n  )\n) %>% filter(!is.na(gp_race_cat)) %>%\n  group_by(year, gp_race_cat) %>% \n  summarise(across(c(starts_with(\"level\"),starts_with(\"me\"),\n                     \"hnumber\"), \n                   ~sum(.x, na.rm=TRUE)))\n\nhead(clean_h_income)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 16\n# Groups:   year [2]\n  year  gp_race…¹ level1 level2 level3 level4 level5 level6 level7 level8 level9\n  <chr> <chr>      <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 1967  grp_all     14.8   10.2   10.9   16.8   24.8   11.9    7.7    1.7    1.2\n2 1967  grp_black   26.8   17.7   15.2   16.4   14.8    5.5    2.7    0.6    0.3\n3 1967  grp_white   13.5    9.4   10.4   16.9   25.8   12.6    8.2    1.8    1.3\n4 1968  grp_all     13.4   10.1   10.4   16.5   24.8   13.7    8.2    1.8    1.1\n5 1968  grp_black   24.4   17     15.5   16.2   16.6    6.5    3.2    0.4    0.1\n6 1968  grp_white   12.3    9.3    9.8   16.5   25.7   14.5    8.8    1.9    1.2\n# … with 5 more variables: median_income <dbl>, median_error <dbl>,\n#   mean_income <dbl>, mean_error <dbl>, hnumber <dbl>, and abbreviated\n#   variable name ¹​gp_race_cat\n```\n:::\n:::\n\n\n## Univariate Visualizations\n\n1. To visualize how the Household numbers have changed over the years, I chose one category - Asians and specifically from the years 2000-2019. I made use of a bar plot to do this. From this visualization below we can see that there has been a steady increase in the numbers through the years with values peaking for 2013 and 2017. It'll be nice to investigate the reason for the same.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create data\n# Pivot the data only containing household income numbers from 2000 onwards for the group asian\ndata_uv_plot1 <- clean_h_income %>% select(gp_race_cat, hnumber, year) %>%\n  filter(gp_race_cat == \"grp_asian\") %>%\n  dplyr::filter(substr(year,1,1) == \"2\")\n\n# Barplot\nggplot(data_uv_plot1, aes(x=year, y=hnumber)) + geom_bar(stat = \"identity\", fill=rgb(0.1,0.4,0.5,0.7), width=0.8) + coord_flip() + ggtitle(\"Distribution of Household Numbers for Asians from 2000-2019\")\n```\n\n::: {.cell-output-display}\n![](VishnupriyaVaradharaju_Challenge5_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nNext, I wanted to visualize the mean income from the years 2000-2019 across all the races. \nA line graph is the most suitable to show this trend. From the visualization we can see that though the asian group started off only from 1987 with low mean income, they have moved upwards and are currently having the highest income compared to the other races. Furthermore, there are sharp peaks at 2013 and 2017 which need to be investigated further.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_uv_plot2 <- clean_h_income %>% select(gp_race_cat, mean_income, year) \n\n# Plot\nggplot(data_uv_plot2, aes(x=year , y=mean_income,color=gp_race_cat, group=gp_race_cat)) +\n  geom_line() + ggtitle(\"Mean incomes across races from year 1967-2019\") +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))\n```\n\n::: {.cell-output-display}\n![](VishnupriyaVaradharaju_Challenge5_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Bivariate Visualization(s)\n\nHere, the data is pivoted such that the income level distribution for each race and for every year can be seen.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pivoting the data\npivot_data <- clean_h_income %>% ungroup() %>%\n  select(c(year, gp_race_cat, starts_with(\"level\"),hnumber,)) %>%\n  pivot_longer(cols=starts_with(\"level\"), names_to=\"IncomeRange\", values_to=\"percent\")\n\n# Replacing the income range levels\npivot_data$IncomeRange <- str_replace_all(pivot_data$IncomeRange, setNames(income_levels,income_vals))\n\n# Calculating the number of household incomes for each income range distribution\npivot_data_longer <- pivot_data %>% mutate(\n  range_household_number = round((hnumber*percent)/100)\n)\n\npivot_data_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,151 × 6\n   year  gp_race_cat hnumber IncomeRange        percent range_household_number\n   <chr> <chr>         <dbl> <chr>                <dbl>                  <dbl>\n 1 1967  grp_all       60813 Under $15000          14.8                   9000\n 2 1967  grp_all       60813 $15000 to $29000      10.2                   6203\n 3 1967  grp_all       60813 $25000 to $34999      10.9                   6629\n 4 1967  grp_all       60813 $35000 to $49999      16.8                  10217\n 5 1967  grp_all       60813 $50000 to $74999      24.8                  15082\n 6 1967  grp_all       60813 $75000 to $99999      11.9                   7237\n 7 1967  grp_all       60813 $100000 to $149999     7.7                   4683\n 8 1967  grp_all       60813 1500000 to $199999     1.7                   1034\n 9 1967  grp_all       60813 $200000 and over       1.2                    730\n10 1967  grp_black      5728 Under $15000          26.8                   1535\n# … with 2,141 more rows\n```\n:::\n:::\n\n\nWe can visualize by making use of bar plots, how the household numbers are distributed for the different income ranges across the different races. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(pivot_data_longer, aes(x=range_household_number, y=IncomeRange, fill=gp_race_cat)) + \n  geom_bar(stat=\"identity\", position=\"dodge\") + \n  scale_fill_brewer(palette = \"Set1\") + \n  ggtitle(\"Household Income Range from 1967-2019 for all race categories\")\n```\n\n::: {.cell-output-display}\n![](VishnupriyaVaradharaju_Challenge5_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nIn the above visualization, it is seen that the household number for the white group always seems to be the highest compared to the other races. This is mainly because the population of whites is higher in the US. To get a more accurate analysis, the household numbers can be divided by the net population of each of the categories to easily compare the proportions between different races.\n\n",
    "supporting": [
      "VishnupriyaVaradharaju_Challenge5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}