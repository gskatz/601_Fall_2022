{
  "hash": "fd36e756f784e56d0622813067ad36d5",
  "result": {
    "markdown": "---\ntitle: \"Challenge 3 Adam Maciaszek\"\nauthor: \"Adam\"\ndesription: \"Tidy Data: Pivoting\"\ndate: \"09/26/2022\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - challenge_3\n  - usa_households\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(readxl)\nlibrary(summarytools)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Challenge Overview\n\nCleaning and Pivoting A Data Frame \n\n## Read in data\n\nThe data set I have read in is \"USA Households\\*.xlsx\" ⭐⭐⭐⭐\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndataset <- data.frame()\nfile_name <- \"_data/USA Households by Total Money Income, Race, and Hispanic Origin of Householder 1967 to 2019.xlsx\"\ncnames <- read_excel(file_name, sheet = 1, skip = 4, n_max = 0) %>% names()\ncnames[2:9] <- gsub('[\\r\\nto\\r\\n]+', '-',cnames[2:9])\ncnames <- c(\"Year\",\"Number_thousands\",\"Total\",cnames[2:10],\"Median\",\"Error_of_Median\",\"Mean\",\"Error_of_Mean\")\ndataset <- read_excel(file_name, sheet = 1, skip = 5,col_names = cnames)\nprint(dfSummary(dataset))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData Frame Summary  \ndataset  \nDimensions: 383 x 16  \nDuplicates: 0  \n\n--------------------------------------------------------------------------------------------------------------------------\nNo   Variable            Stats / Values                  Freqs (% of Valid)    Graph                  Valid      Missing  \n---- ------------------- ------------------------------- --------------------- ---------------------- ---------- ---------\n1    Year                1. 2002                           8 ( 2.1%)                                  383        0        \n     [character]         2. 2003                           8 ( 2.1%)                                  (100.0%)   (0.0%)   \n                         3. 2004 7                         8 ( 2.1%)                                                      \n                         4. 2005                           8 ( 2.1%)                                                      \n                         5. 2006                           8 ( 2.1%)                                                      \n                         6. 2007                           8 ( 2.1%)                                                      \n                         7. 2008                           8 ( 2.1%)                                                      \n                         8. 2009 6                         8 ( 2.1%)                                                      \n                         9. 2010 5                         8 ( 2.1%)                                                      \n                         10. 2011                          8 ( 2.1%)                                                      \n                         [ 88 others ]                   303 (79.1%)           IIIIIIIIIIIIIII                            \n\n2    Number_thousands    1. 6750                           2 ( 0.6%)                                  340        43       \n     [character]         2. 100065                         1 ( 0.3%)                                  (88.8%)    (11.2%)  \n                         3. 100113                         1 ( 0.3%)                                                      \n                         4. 10034                          1 ( 0.3%)                                                      \n                         5. 100528                         1 ( 0.3%)                                                      \n                         6. 100568                         1 ( 0.3%)                                                      \n                         7. 101018                         1 ( 0.3%)                                                      \n                         8. 10192                          1 ( 0.3%)                                                      \n                         9. 102528                         1 ( 0.3%)                                                      \n                         10. 103874                        1 ( 0.3%)                                                      \n                         [ 329 others ]                  329 (96.8%)           IIIIIIIIIIIIIIIIIII                        \n\n3    Total               1 distinct value                100 : 340 (100.0%)    IIIIIIIIIIIIIIIIIIII   340        43       \n     [numeric]                                                                                        (88.8%)    (11.2%)  \n\n4    Under $15,000       Mean (sd) : 13.1 (5.2)          142 distinct values     :                    340        43       \n     [numeric]           min < med < max:                                        :                    (88.8%)    (11.2%)  \n                         6.3 < 10.9 < 27.2                                       : :                                      \n                         IQR (CV) : 7.2 (0.4)                                  . : :       .                              \n                                                                               : : : : . . : . . .                        \n\n5    $15,000-$24,999     Mean (sd) : 10.7 (2.7)          104 distinct values         :                340        43       \n     [numeric]           min < med < max:                                            :                (88.8%)    (11.2%)  \n                         5 < 10.1 < 17.7                                             : :                                  \n                         IQR (CV) : 3.8 (0.3)                                    : . : : . : .                            \n                                                                               . : : : : : : : : .                        \n\n6    $25,000-$34,999     Mean (sd) : 10.1 (2.1)          87 distinct values            :              340        43       \n     [numeric]           min < med < max:                                            . :   .          (88.8%)    (11.2%)  \n                         5 < 9.9 < 15.5                                              : : . :                              \n                         IQR (CV) : 2.7 (0.2)                                    .   : : : : .                            \n                                                                               . : : : : : : : :                          \n\n7    $35,000-$49,999     Mean (sd) : 13.5 (2.2)          93 distinct values            : .            340        43       \n     [numeric]           min < med < max:                                              : :            (88.8%)    (11.2%)  \n                         7.7 < 13.8 < 20.6                                           . : : .                              \n                         IQR (CV) : 2.3 (0.2)                                    .   : : : :                              \n                                                                               . : : : : : : .                            \n\n8    $50,000-$74,999     Mean (sd) : 18 (2.4)            92 distinct values          :                340        43       \n     [numeric]           min < med < max:                                          : :                (88.8%)    (11.2%)  \n                         12.9 < 17.5 < 25.8                                        : : .                                  \n                         IQR (CV) : 2.9 (0.1)                                    . : : : :                                \n                                                                               . : : : : : : :   .                        \n\n9    $75,000-$99,999     Mean (sd) : 12.2 (2.1)          86 distinct values                : .        340        43       \n     [numeric]           min < med < max:                                                  : :        (88.8%)    (11.2%)  \n                         5.5 < 12.6 < 16.3                                           :     : : :                          \n                         IQR (CV) : 3.4 (0.2)                                        : : . : : :                          \n                                                                                 . : : : : : : : :                        \n\n10   $100,000-$149,999   Mean (sd) : 12.6 (4)            130 distinct values         .     :          340        43       \n     [numeric]           min < med < max:                                            :     : :        (88.8%)    (11.2%)  \n                         2.7 < 13.1 < 19.9                                           : . . : :                            \n                         IQR (CV) : 6.4 (0.3)                                      . : : : : : .                          \n                                                                               . : : : : : : : :                          \n\n11   $150,000-$199,999   Mean (sd) : 5.1 (2.9)           104 distinct values       :                  340        43       \n     [numeric]           min < med < max:                                          :                  (88.8%)    (11.2%)  \n                         0.4 < 4.3 < 12.5                                        . :     :                                \n                         IQR (CV) : 4.1 (0.6)                                  : : : . . :                                \n                                                                               : : : : : : : : . .                        \n\n12   $200,000 and over   Mean (sd) : 4.7 (3.8)           115 distinct values     :                    340        43       \n     [numeric]           min < med < max:                                      : :                    (88.8%)    (11.2%)  \n                         0.1 < 3.5 < 18.9                                      : :   :                                    \n                         IQR (CV) : 4.9 (0.8)                                  : : . :   .                                \n                                                                               : : : : . : .   .                          \n\n13   Median              Mean (sd) : 55534.5 (14465.9)   339 distinct values     :     :              340        43       \n     [numeric]           min < med < max:                                        :   : :              (88.8%)    (11.2%)  \n                         29026 < 56101.5 < 98174                                 :   : : :                                \n                         IQR (CV) : 22391.5 (0.3)                              : : : : : : . .                            \n                                                                               : : : : : : : : .                          \n\n14   Error_of_Median     Mean (sd) : 1143.7 (996.3)      308 distinct values   :                      340        43       \n     [numeric]           min < med < max:                                      :                      (88.8%)    (11.2%)  \n                         268 < 813 < 6080                                      : .                                        \n                         IQR (CV) : 839.5 (0.9)                                : :                                        \n                                                                               : : . . . .                                \n\n15   Mean                1. 100041                         1 ( 0.3%)                                  340        43       \n     [character]         2. 100399                         1 ( 0.3%)                                  (88.8%)    (11.2%)  \n                         3. 101732                         1 ( 0.3%)                                                      \n                         4. 101962                         1 ( 0.3%)                                                      \n                         5. 102300                         1 ( 0.3%)                                                      \n                         6. 102588                         1 ( 0.3%)                                                      \n                         7. 102752                         1 ( 0.3%)                                                      \n                         8. 103291                         1 ( 0.3%)                                                      \n                         9. 103725                         1 ( 0.3%)                                                      \n                         10. 103815                        1 ( 0.3%)                                                      \n                         [ 330 others ]                  330 (97.1%)           IIIIIIIIIIIIIIIIIII                        \n\n16   Error_of_Mean       1. N                              3 ( 0.9%)                                  340        43       \n     [character]         2. 1033                           2 ( 0.6%)                                  (88.8%)    (11.2%)  \n                         3. 1167                           2 ( 0.6%)                                                      \n                         4. 1240                           2 ( 0.6%)                                                      \n                         5. 1333                           2 ( 0.6%)                                                      \n                         6. 1371                           2 ( 0.6%)                                                      \n                         7. 3050                           2 ( 0.6%)                                                      \n                         8. 306                            2 ( 0.6%)                                                      \n                         9. 310                            2 ( 0.6%)                                                      \n                         10. 316                           2 ( 0.6%)                                                      \n                         [ 301 others ]                  319 (93.8%)           IIIIIIIIIIIIIIIIII                         \n--------------------------------------------------------------------------------------------------------------------------\n```\n:::\n:::\n\n### Cleaning and adding missing data\nEach Demographic in the data set is sepereated in sections and lists all the years recorded for that demographic. This needs to be added as a column for each of the data points. These lines are blank aside from labeling the demographic in the first column so you can collect and mark which rows belong to which demographic. Another item to be cleaned is the aggregate data for \"all races\" as this is combination of other data points.The extra lines of information explaining the table at the need to be removed.\n\n::: {.cell}\n\n```{.r .cell-code}\nrace_name_rows <- which(is.na(dataset$Total))\nrace_name_rows <- race_name_rows[1:13]\n\nrace_names <- c()\nfor (x in dataset[race_name_rows,1]){\n     x <- gsub('[0-9]+', '', x)\n    race_names <- c(race_names,x)\n}\n\nrace_values=c(NA)\nindex<-1\nnum_rows<-0\nfor (x in race_names){\n    if (index>12) {break}\n    num_rows<- race_name_rows[index+1]-race_name_rows[index]\n    for (y in 1:num_rows){\n        race_values <- c(race_values,x)}\n    index <- index + 1\n}\n\ndataset$\"Mean\" <- as.numeric(as.character(dataset$\"Mean\"))\ndataset$\"Median\"  <- as.numeric(as.character(dataset$\"Median\"))\ndataset$\"Error_of_Median\"  <- as.numeric(as.character(dataset$\"Error_of_Median\"))\ndataset$\"Error_of_Mean\"  <- as.numeric(as.character(dataset$\"Error_of_Mean\"))\n\ndataset <- dataset[-c(354:383),]\n\ndataset$Race <- race_values\n\ndataset <- dataset[-which(is.na(dataset$Total)),]\ndataset <- dataset %>% select(-\"Total\")\n\ndataset <- dataset[-which(dataset$Race==\"ALL RACES\"),]\n\ndataset <- dataset %>% separate(Year, c('Year', 'Year2'))\ndataset <- dataset %>% select(-Year2)\n```\n:::\n\n### Seperating Means and Medians\nFor the data to be tidy  it needs to be separated into each observation and the mean and median would need to repeated for each observation of income level which is extraneous. This data is still useful so it is separated into its own table.\n\n::: {.cell}\n\n```{.r .cell-code}\nmedians_means <- dataset %>% select(\"Year\",\"Race\",\"Mean\",\"Error_of_Mean\",\"Median\",\"Error_of_Median\")\ndataset <- dataset %>% select(-\"Mean\",-\"Error_of_Mean\",-\"Median\",-\"Error_of_Median\")\n```\n:::\n\n### Why Pivot & Final Dimensions\nThis data needs to be pivoted since it is hard to read and filter since there are multiple observations all in one row. This makes data maniopulation grouping filtering and sort much more inconvient. The final dimensions will have many more rows but only 4 columns. This is because there are a total of 9 different income levels that are going to be represented with one column containing a string which is that bracket of income level. Below is a calulation of how many new rows there will be considering each demographic the year taken and thier income level will have its own dedicated row.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_rows <- nrow(dataset) * (ncol(dataset)-3)\nnew_col <- 3 + 1\ncat(sprintf(\"After pivoting the expected number of rows is %s and the number of columns is %s\\nThe current number of rows is %s and the number of columns is %s\\n\",nrow(dataset),ncol(dataset),new_rows,new_col))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAfter pivoting the expected number of rows is 285 and the number of columns is 12\nThe current number of rows is 2565 and the number of columns is 4\n```\n:::\n:::\n\n\n### Challenge: Pivot the Chosen Data\n\n::: {.cell}\n\n```{.r .cell-code}\ndataset <- dataset %>% \n  pivot_longer(\n    cols=cnames[4:12], \n    names_to = \"income_level\", \n    values_to = \"percent\", \n    values_drop_na = TRUE\n  )\ndataset$Number_thousands  <- as.numeric(as.character(dataset$Number_thousands ))\ndataset$percent  <- as.numeric(as.character(dataset$percent))\ndataset$Number_thousands <- dataset$Number_thousands * dataset$percent/100\ndataset <- dataset %>% select(-percent)\ndataset$Number_thousands <- dataset$Number_thousands %>% replace_na(0)\ncat(sprintf(\"To confirm after pivoting the current number of rows is %s and the number of columns is %s\\n\",nrow(dataset),ncol(dataset)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTo confirm after pivoting the current number of rows is 2565 and the number of columns is 4\n```\n:::\n:::\n\n### Graphing the data\n\n::: {.cell}\n\n```{.r .cell-code}\nonly_race_income <- dataset %>% select(-Year)\ninvisible(only_race_income %>% group_by(Race,income_level) %>% summarise(across(Number_thousands, sum)))\nonly_race_income$income_level = factor(only_race_income$income_level, levels = rev(cnames[4:12]))\nggplot(only_race_income, aes(fill=Race, y=income_level, x=Number_thousands)) + geom_bar(position=\"dodge\", stat=\"identity\")+ ggtitle(\"Total Number Of Demographic Per Income Bracket From (1967-2019)\")\n```\n\n::: {.cell-output-display}\n![](challenge3_AdamMaciaszek_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#options(repr.plot.width = 20, repr.plot.height =20)\nggplot(medians_means, aes(x = Year, y = Mean,ymin = Mean-Error_of_Mean, ymax = Mean+Error_of_Mean, group=Race, color=Race)) + geom_errorbar(width = 0.2) + geom_line() + scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+ggtitle(\"Mean Income Levels From (1967-2019)\")\n```\n\n::: {.cell-output-display}\n![](challenge3_AdamMaciaszek_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(medians_means, aes(x = Year, y = Median,ymin = Median-Error_of_Median, ymax = Median+Error_of_Median, group=Race, color=Race)) + geom_errorbar(width = 0.2) + geom_line() + scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+ggtitle(\"Mean Income Levels From (1967-2019)\")\n```\n\n::: {.cell-output-display}\n![](challenge3_AdamMaciaszek_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n:::",
    "supporting": [
      "challenge3_AdamMaciaszek_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}