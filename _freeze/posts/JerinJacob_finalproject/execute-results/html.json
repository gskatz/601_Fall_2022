{
  "hash": "b0d7b13bcaeb900b584ed92946e3c8d3",
  "result": {
    "markdown": "---\ntitle: \"JerinJacob_final_projectpdf\"\nauthor: \"Jerin Jacob\"\ndate: \"2022-12-27\"\noutput: pdf_document\n---\n\n<style>\nbody {\ntext-align: justify}\n</style>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readr)\nlibrary(stringr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(readxl)\nlibrary(hrbrthemes)\nlibrary(usmap)\nlibrary(tidycensus)\n```\n:::\n\n\n\n## Introduction\n\nThis is an analysis of crime data (both violent and non-violent) of all the counties in the State of Massachusetts for the year 2021. The crime data of all 14 counties were available, but as separate files. Also, to make a better analysis, I decided to keep the number of crimes as a function of population. The population data was downloaded from US census website. The top 3 reasons for increased crime rates at a place were identified as poverty rate, unemployment rate and youth male population. These data are also taken from census data.\n\n## Reading the Data:\n\nReading crime data from 14 files, concatenating them to a single dataframe & cleaning. To read all the 14 files and concatenate it as a single dataframe, a function was written.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfilepath <- \"_data/601_final_project_jerin_jacob/\"\ncsv_file_names <- list.files(path = filepath, pattern = \"_2021*\")\n#csv_file_names\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nread_crimes<-function(file_name){\n  x<-unlist(str_split(file_name, pattern=\"[[:punct:]]\", n=3))\n  read_csv(paste0(filepath, file_name),\n           skip = 8, \n           col_names = c(\"Location\",\"6pm-9pm\",\"9pm-12am\",\"12am-3am\",\"3am-6am\",\"6am-9am\",\"9am-12pm\",\"12pm-3pm\",\"3pm-6pm\"), show_col_types = FALSE)%>%\n             mutate(County = x[1],\n                    Year = x[2])\n}\ncounties<-\n  purrr::map_dfr(csv_file_names, read_crimes) %>%\n  select(`Location`, `12am-3am`, `3am-6am`,  `6am-9am`, `9am-12pm`, `12pm-3pm`, `3pm-6pm`, `6pm-9pm`, `9pm-12am`, `County`, `Year`)\n#counties\n```\n:::\n\n\nReading & cleaning data for population, unemployment, poverty rate, age & sex, median household income\n\n\n::: {.cell}\n\n```{.r .cell-code}\nma_population <- read_csv('_data/601_final_project_jerin_jacob/MA_population.csv', col_names = c(\"Number\", \"County\", \"Population\"))\n\nma_population$County <- word(ma_population$County, 1)\n\nma_population <- ma_population[ -c(1) ]\n\nma_population\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 14 × 2\n   County     Population\n   <chr>           <dbl>\n 1 Middlesex     1605899\n 2 Worcester      826655\n 3 Suffolk        801162\n 4 Essex          787038\n 5 Norfolk        703740\n 6 Bristol        563301\n 7 Plymouth       518597\n 8 Hampden        466647\n 9 Barnstable     213505\n10 Hampshire      161361\n11 Berkshire      125927\n12 Franklin        70529\n13 Dukes           17430\n14 Nantucket       11212\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nunemployment <- read_csv('_data/601_final_project_jerin_jacob/LURReport.csv', skip = 6) %>%\n  drop_na(Month) %>%\n  filter(Month == \"Annual\") %>%\n  filter(Year == \"2020\") %>%\n  mutate(County = str_remove_all(Area, \" COUNTY\")) %>%\n  select(County, `Area Rate`)%>%\n  rename(\"unemp_rate\" = \"Area Rate\") \nunemployment$County <- str_to_title(unemployment$County)\n#unemployment\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npoverty <- read_excel('_data/601_final_project_jerin_jacob/PovertyReport.xlsx', skip = 4) %>%\n  mutate(County = Name, poverty_rate = Percent...7) %>%\n  select(County, poverty_rate) %>%\n  filter(!County == \"Massachusetts\")\n\n  \n#poverty\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nage_sex <- read_csv('_data/601_final_project_jerin_jacob/age_sex.csv', show_col_types = FALSE)%>%\n  mutate(County = str_remove_all(CTYNAME, \" County\")) %>%\n  filter(YEAR == 12) %>%\n    mutate(male18_24 = round((AGE1824_MALE/POPESTIMATE)*100)) %>%\n    mutate(male25_29 = round((AGE2529_MALE/POPESTIMATE)*100)) %>%\n  select(County, male18_24, male25_29)\nage_sex$young_males_total <- as.numeric(apply(age_sex[, 2:3], 1, sum))\n  \n\nage_sex <- age_sex %>%\n  select(County, young_males_total)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmedian_hh <- read_excel('_data/601_final_project_jerin_jacob/householdincome.xlsx', skip = 2) %>%\n select(Name, `Median Household Income (2020)`)\ncolnames(median_hh) <- c('County', 'median_hh_income')\nmedianhh <- filter(median_hh, grepl(\"County\", County, ignore.case = TRUE))\nmedianhh$County <- word(filtered_medianhh$County, 1) \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in vctrs::vec_recycle_common(string = string, start = start, end = end): object 'filtered_medianhh' not found\n```\n:::\n\n```{.r .cell-code}\n#scaled_medianhh$income_factor <- scaled_medianhh$median_hh_income / 8000\nmedianhh\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 14 × 2\n   County                    median_hh_income\n   <chr>                                <dbl>\n 1 Barnstable County, MA                76287\n 2 Berkshire County, MA                 65458\n 3 Bristol County, MA                   71998\n 4 Dukes County, MA                     80459\n 5 Essex County, MA                     88269\n 6 Franklin County, MA                  62920\n 7 Hampden County, MA                   61600\n 8 Hampshire County, MA                 73864\n 9 Middlesex County, MA                111158\n10 Nantucket County/town, MA            95713\n11 Norfolk County, MA                  106348\n12 Plymouth County, MA                  88420\n13 Suffolk County, MA                   85221\n14 Worcester County, MA                 77931\n```\n:::\n:::\n\n\n## 4 main reasons for increase in crime rates\n\nTo make the analysis easier, I joined (left join) the data of the four parameters that are thought to be the main factors causing increased crime rate, which are Poverty, Unemployment, Median Household Income and Youth male population.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrimerate_reasons <- left_join(unemployment, poverty, by = 'County') %>%\n  left_join(., age_sex, by = 'County') #%>%\n  #left_join(., scaled_medianhh, by = 'County')\n  \n# crimerate_reasons %>%\n#   select(!income_factor)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nCounty_crime_total <- filter(counties, Location == \"All Location Types\")\n#County_crime_total\n#head(ma_population)\n```\n:::\n\n\nTo get the crime rate for each county, I joined the population data of the counties with the crime data and made the number of crimes a function of per 100000 people in the county so that we can compare crime rate by each county.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_crime_rate <- County_crime_total %>%\n  left_join(ma_population,by= \"County\")%>%\n  mutate(across(c(2:9),\n           .fns = ~./(Population/100000)))%>%\n  pivot_longer(cols = (ends_with(\"am\") | ends_with(\"pm\")) | ends_with(\"noon\"), names_to = \"Time\", values_to = \"Crime_Rate\")\ndf_crime_rate$Crime_Rate <- round(df_crime_rate$Crime_Rate)\ndf_crime_rate$Time<- factor(df_crime_rate$Time,                 # Relevel group factor\n                         levels = c(\"12am-3am\", \"3am-6am\", \"6am-9am\", \"9am-12pm\", \"12pm-3pm\", \"3pm-6pm\", \"6pm-9pm\",\"9pm-12am\"))\ndf_crime_rate <- df_crime_rate %>%\n  group_by(County)\ndf_crime_rate\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 112 × 6\n# Groups:   County [14]\n   Location           County     Year  Population Time     Crime_Rate\n   <chr>              <chr>      <chr>      <dbl> <fct>         <dbl>\n 1 All Location Types Barnstable 2021      213505 12am-3am        201\n 2 All Location Types Barnstable 2021      213505 3am-6am          89\n 3 All Location Types Barnstable 2021      213505 6am-9am         284\n 4 All Location Types Barnstable 2021      213505 9pm-12am        310\n 5 All Location Types Barnstable 2021      213505 9am-12pm        615\n 6 All Location Types Barnstable 2021      213505 12pm-3pm        666\n 7 All Location Types Barnstable 2021      213505 3pm-6pm         592\n 8 All Location Types Barnstable 2021      213505 6pm-9pm         454\n 9 All Location Types Berkshire  2021      125927 12am-3am        195\n10 All Location Types Berkshire  2021      125927 3am-6am         137\n# … with 102 more rows\n```\n:::\n:::\n\n\n## Analysis\n\n### Finding which county has the highest crime rate \nWhen I analysed the county wise crime rate, Hampden (5783) came out to be the top county in crime rate followed by Suffolk (5511) and Nantucket (4066) in the year 2021. Norfolk had the least crime rate (2186)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwhich_county <- df_crime_rate %>%\n  # select(County, Crime_Rate) %>%\n  group_by(County) %>%\n  summarise(Crime_Rate = sum(Crime_Rate)) %>%\n#test\n\n  ggplot(aes(x = County, y = Crime_Rate, fill = County)) +\n    geom_bar(stat = \"identity\", position = position_dodge(0.9)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  geom_text(aes(label = Crime_Rate), vjust = 0) +\n  ggtitle(\"Counties Having Highest Crime Rate\")\n\nwhich_county\n```\n\n::: {.cell-output-display}\n![](JerinJacob_finalproject_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n### Finding which time of the day has the highest crime rate\n\nSince the data had time of the day as a variable, I was curious to know what time of the day has more probability for a crime to happen. It was surprising to me to find out that 12pm-3pm had the most number of crimes followed by 3pm-6pm and 9am-12-pm. It is an interesting finding that nights are safer in Massachusetts than daytime as far as the number of crimes are concerned.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntime_graph <- County_crime_total %>%\n  pivot_longer(cols = (ends_with(\"am\") | ends_with(\"pm\")) | ends_with(\"noon\"), \n               names_to = \"Time\", values_to = \"Crimes\")\ntime_graph$Time<- factor(time_graph$Time,                 # Relevel group factor\n                         levels = c(\"12am-3am\", \"3am-6am\", \"6am-9am\", \"9am-12pm\", \"12pm-3pm\", \"3pm-6pm\", \"6pm-9pm\",\"9pm-12am\"))\n\ntime_graph <- time_graph%>%\n  group_by(Time) %>%\n  summarise(Crimes = sum(Crimes))\n\ntime_graph %>%\n  tail(10) %>%\n\n  ggplot(aes(x = Time, y = Crimes)) +\n  geom_point(shape = 21, color = \"black\", fill = \"red\", size = 4) +\n  geom_line(color = \"grey\") +\n  theme_ipsum() +\n  ggtitle(\"Time When Most Crimes Happen\") +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))\n```\n\n::: {.cell-output-display}\n![](JerinJacob_finalproject_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nThe counties having the most crime rate follow the same pattern in the time of the day in which more crimes happen.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_crime_rate %>%\n  filter(County == \"Hampden\" | County == \"Suffolk\"| County ==  \"Nantucket\") %>%\n  group_by(County, Time) %>%\n  summarise(CrimeRate = sum(Crime_Rate)) %>%\n  ggplot(aes(x = County, y = CrimeRate, fill = Time)) + \n    geom_bar(stat = \"identity\", position = position_dodge(0.9)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  ggtitle(\"Time vs Counties with Top Crime Rates\")\n```\n\n::: {.cell-output-display}\n![](JerinJacob_finalproject_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n## Analysing the reasons behind the crime rate.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# crimerate_reasons %>%\n#   select(!income_factor)\n```\n:::\n\n\nAs expected, Hampden (14.3%) and Suffolk (16.5%) had a higher rate of poverty but surprisingly, Nantucket has the lowest poverty rate (5.3%) even though Nantucket is in the top three counties in crime rate. However, Nantucket had the highest unemployment rate (11.1%) followed by Hampden (11.0%). Suffolk too had a comparatively higher unemployment rate (10.3%). When it comes to the percentage of young males of age 18-29, Hampshire is the top county regardless of its lower crime rate. But Suffolk and Hampden has some correlation between the crime rate and the percentage of young male. Hampden and Suffolk are having their median household income at $61600 and $85221 respectively which are lower than that of median household income of the Massachusetts state($89,026). \n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrimerate_reasons %>%\n  pivot_longer(!County, names_to = \"Reason\", values_to = \"Percent\") %>%\n  ggplot(aes(x=County, y=Percent, group=Reason, color=Reason)) +\n  geom_line() +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1 )) +\n  ggtitle(\"Causes of Increased Crime Rate\")\n```\n\n::: {.cell-output-display}\n![](JerinJacob_finalproject_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmedianhh %>%\n  ggplot(aes(x = County, y = median_hh_income, fill = median_hh_income)) +\n    geom_bar(stat = \"identity\", position = position_dodge(0.9)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  geom_text(aes(label = median_hh_income), vjust = 0, size = 3) +\n  ggtitle(\"Countywise Median Household Income\")\n```\n\n::: {.cell-output-display}\n![](JerinJacob_finalproject_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## Conclusion\n\nAs expected, poverty, unemployment and median household income are showing some significant correlation with the crime rates in the counties of Massachusetts. Age and gender are moderating the other reasons to increase the crime rate.\n\n## Limitation of study and future scope\n\nThe study was done only with the data of 2021 and there are other factors that affect the crime rate. Due to the time constraint and unavailability of data, I am concluding my analysis here. But this analysis can be done in future with data of more years and including other variables that affect the crime rate.\n\n## Bibliography\n\nSource of data:\n\n1, https://masscrime.chs.state.ma.us/public/View/dispview.aspx\n\n2, https://lmi.dua.eol.mass.gov/LMI/LaborForceAndUnemployment\n\n3, https://data.census.gov\n\nProgramming Language: R\n\nCourse book : R for Data Science by Hadley Wickham & Garrett Grolemund\n",
    "supporting": [
      "JerinJacob_finalproject_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}